openapi: 3.0.3
info:
  title: Projex WFM Analytics Dashboard - Project Analytics API
  description: |
    REST API for Project Analytics module. This is one of several modules in the Projex WFM Analytics Dashboard.
    
    **Authentication:**
    - Dev mode: No authentication required
    - Prod mode: JWT token required (authenticate via /api/auth/login)
  version: 1.0.0
  contact:
    name: GDC Digital Solutions

servers:
  - url: http://localhost:5000
    description: Local development server
  - url: https://api.example.com
    description: Production server

tags:
  - name: Auth
    description: Frontend service authentication
  - name: Projects
    description: Project analytics endpoints

paths:
  /api/auth/login:
    post:
      tags: [Auth]
      summary: Authenticate frontend service
      description: Get JWT token for frontend service authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [api_key, api_secret]
              properties:
                api_key:
                  type: string
                  description: Frontend API key
                api_secret:
                  type: string
                  description: Frontend API secret
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                  token_type:
                    type: string
                    example: bearer
                  expires_in:
                    type: integer
                    description: Token expiration in seconds
        '401':
          description: Invalid credentials
        '500':
          description: Server configuration error

  /api/auth/me:
    get:
      tags: [Auth]
      summary: Get current authenticated service info
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Service information
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                  auth_mode:
                    type: string
                    enum: [dev, prod]

  /api/projects/health:
    get:
      tags: [Projects]
      summary: Health check
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  service:
                    type: string

  /api/projects:
    get:
      tags: [Projects]
      summary: Get all projects
      description: Get all projects with budget information and status
      security:
        - bearerAuth: []
      parameters:
        - name: status
          in: query
          description: Filter by project status code
          required: false
          schema:
            type: integer
      responses:
        '200':
          description: List of projects
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Project'
        '500':
          description: Server error

  /api/projects/summary:
    get:
      tags: [Projects]
      summary: Get projects summary
      description: Get aggregated statistics for all projects
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Summary statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectsSummary'
        '500':
          description: Server error

  /api/projects/{project_id}/budget:
    get:
      tags: [Projects]
      summary: Get project budget details
      description: Get detailed budget information for a specific project
      security:
        - bearerAuth: []
      parameters:
        - name: project_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Budget details
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Budget'
        '500':
          description: Server error

  /api/projects/manager-leaderboard:
    get:
      tags: [Projects]
      summary: Get PM leaderboard
      description: Get project manager performance leaderboard
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Leaderboard data
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ManagerLeaderboard'
        '500':
          description: Server error

  /api/projects/timeline:
    get:
      tags: [Projects]
      summary: Get projects timeline
      description: Get timeline data for Gantt chart visualization
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Timeline data
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TimelineItem'
        '500':
          description: Server error

  /api/projects/risks:
    get:
      tags: [Projects]
      summary: Get project risks
      description: Get projects with risk alerts (overdue or over budget)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Risk alerts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RiskAlert'
        '500':
          description: Server error

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token from /api/auth/login (required in prod mode)

  schemas:
    Project:
      type: object
      properties:
        project_id:
          type: integer
        project_name:
          type: string
        client_id:
          type: integer
        client_name:
          type: string
        project_manager:
          type: integer
        manager_name:
          type: string
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        status:
          type: integer
        total_allocated:
          type: number
          format: float
        total_burnt:
          type: number
          format: float
        total_remaining:
          type: number
          format: float
        budget_variance:
          type: number
          format: float
          description: Budget variance percentage
        status_category:
          type: string
          enum: [active, overdue, completed]
        days_overdue:
          type: integer

    ProjectsSummary:
      type: object
      properties:
        total_projects:
          type: integer
        active_projects:
          type: integer
        overdue_projects:
          type: integer
        completed_projects:
          type: integer
        total_budget_allocated:
          type: number
          format: float
        total_budget_burnt:
          type: number
          format: float
        total_budget_remaining:
          type: number
          format: float

    Budget:
      type: object
      properties:
        budget_id:
          type: integer
        budget_name:
          type: string
        budget_type:
          type: string
          enum: [Time, Expenses]
        allocated_amount:
          type: number
          format: float
        burnt_amount:
          type: number
          format: float
        remaining_amount:
          type: number
          format: float
        status:
          type: integer

    ManagerLeaderboard:
      type: object
      properties:
        project_manager:
          type: integer
        manager_name:
          type: string
        total_projects:
          type: integer
        completed_projects:
          type: integer
        overdue_projects:
          type: integer
        active_projects:
          type: integer
        total_budget_managed:
          type: number
          format: float
        total_burnt:
          type: number
          format: float
        avg_budget_variance:
          type: number
          format: float
          description: Average budget variance percentage

    TimelineItem:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        client:
          type: string
        manager:
          type: string
        start:
          type: string
          format: date
        end:
          type: string
          format: date
        status:
          type: string
          enum: [active, completed]
        budget_allocated:
          type: number
          format: float
        budget_burnt:
          type: number
          format: float

    RiskAlert:
      type: object
      properties:
        project_id:
          type: integer
        project_name:
          type: string
        client_name:
          type: string
        manager_name:
          type: string
        days_overdue:
          type: integer
        budget_variance_pct:
          type: number
          format: float
        allocated_amount:
          type: number
          format: float
        burnt_amount:
          type: number
          format: float
        alerts:
          type: array
          items:
            type: string
        risk_level:
          type: string
          enum: [high, medium]

